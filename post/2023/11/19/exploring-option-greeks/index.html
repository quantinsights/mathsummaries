<!DOCTYPE html>
<html lang="en-us">
<title>Exploring Option Greeks | Math Summaries</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.118.2">
<meta name="description" content="I present here some quantitative finance projects that I have done or have been working on. Hope they can be of any help to you.&#34;&#34;">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://quantophile.github.io/mathsummaries/css/minimal.css">
<link rel="canonical" href="https://quantophile.github.io/mathsummaries/post/2023/11/19/exploring-option-greeks/">
<link rel="alternate" type="application/rss+xml" href="" title="Math Summaries">
<link rel="stylesheet" href="https://quantophile.github.io/mathsummaries/katex/katex.min.css">
<script defer src="https://quantophile.github.io/mathsummaries/katex/katex.min.js"></script>
<script defer src="https://quantophile.github.io/mathsummaries/katex/contrib/auto-render.min.js" onload="renderMathInElement(document.body)"></script>

<header>
  
    <a href="https://quantophile.github.io/mathsummaries/" class="title">Math Summaries</a>
  
  
    <nav>
    
      <a href="">Home</a>
    
      <a href="about/">About</a>
    
      <a href="categories/">Categories</a>
    
      <a href="tags/">Tags</a>
    
      <a href="index.xml">Subscribe</a>
    
    </nav>
  
</header>

<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"
    integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ"
    crossorigin="anonymous"
    referrerpolicy="no-referrer">

<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"
    integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
    type="text/javascript"></script>

<script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js"
    integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
    type="text/javascript"></script>

<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "\\[", right: "\\]", display: true},
        {left: "$", right: "$", display: false},
        {left: "\\(", right: "\\)", display: true},
      ],
    });
  });
</script>

<article>
  <header>
    <h1>Exploring Option Greeks</h1>
    <time datetime="2023-11-19T22:55:20&#43;01:00">November 19, 2023</time>
  </header>
  <h2 id="introduction">Introduction.</h2>
<p>I derived the Black-Scholes formula for European style vanilla FX options in a previous post <a href="https://quantophile.github.io/mathsummaries/post/2023/11/19/garman-kohlhagen-for-european-vanilla-fx-options/">here</a>. The Black-Scholes model $Bl(S_0,K,T,r_{DOM},r_{FOR},\sigma)$ equipped with a single flat volatility parameter $\sigma$ produces option prices which are <strong>NOT consistent</strong> with the observed market prices of FX options across different strikes and maturities.</p>
<p>Although, the BS model suffers many flaws, it is still often used, at least for quoting purposes. Since all of the other inputs into the model - market data variables such as the stock price $S_0$, the domestic depo rate $r_{DOM}$, the foreign depo rate $r_{FOR}$, and the parameters such as option strike $K$, the time-to-maturity $T$, can be either seen in the market or are known constants, we can easily solve for the value $\sigma_{\text{imp}}$ of the parameter $\sigma$ such that:</p>
<p>$$Bl(S_0,K,T,r_{DOM},r_{FOR},\sigma_{\text{imp}}) = V_{\text{market}}$$</p>
<p>This value $\sigma_{\text{imp}}$ implied from the market price of the option is called the <strong>implied volatility</strong>.</p>
<p>Thus, although the BS model suffers from flaws, it is mainly used as a quote converter. In the FX options market, option prices are quoted in terms of implied volatilities. The BS formula is used to convert implied vols $\sigma_{\text{imp}}$ to prices and vice versa. The delta hedge to be exchanged between counterparties is calculated according to the BS formula, and this is also true for the Vega hedge of various exotic options. In many cases, the model is also used to run trading books.</p>
<p>In this note, I explore various delta conventions and derive the greeks. Check out <a href="https://mathfinance.com/wp-content/uploads/2017/06/CPQF_Arbeits20_neu2.pdf">FX Vol smile</a> by Wyestup! The entire concept of the FX volatility smile is based on the parametrization with respect to delta.</p>
<h2 id="quote-style-conversions">Quote style conversions.</h2>
<p>In FX markets, options are quoted in one of 4 quote styles - domestic per foreign (d/f), percentage foreign (%f), percentage domestic (%d) and foreign per domestic (f/d).</p>
<p>The standard Black-Scholes formula is:</p>
<p>$$
\begin{align*}
V_{d/f} &amp;= \omega [S_0 e^{-r_{FOR} T} \Phi(d_{+}) - K e^{-r_{DOM}T} \Phi(d_{-})\\
&amp;= \omega e^{-r_{DOM}T}[F \Phi(d_{+}) - K  \Phi(d_{-})]
\end{align*}
$$</p>
<p>Whether a call or a put, it is an option to exchange $K$ units of the domestic currency for $1$ unit of the foreign currency, valued in domestic currency - so it is the domestic/foreign price.</p>
<p>If we want to express the above as a CCY1/CCY1 price, the conversion is easy : we just take the CCY2/CCY1 price above and convert the CCY2 value into CCY1 terms using today&rsquo;s spot rate $S_0$:</p>
<p>$$
V_{\text{\% f}} = \frac{\omega}{S_0}e^{-r_{DOM}T}[F\Phi(\omega d_{+}) - K\Phi(\omega d_{-})] = \frac{V_{d/f}}{S_0}
$$</p>
<p>For the %CCY2 price, we start with the CCY2/CCY1 price, this being the price in CCY2 of an option with a unit notional in the foreign currency. Since the strike is predetermined, it is also the price in CCY2 of an option with a notional of $K$ in CCY2. So, the CCY1/CCY2 price divided by $K$, is the $%ccy2$ price i.e. the percentage domestic price:</p>
<p>$$V_{\%d} = \frac{\omega}{K} e^{-r_{DOM}T}[F \Phi(d_{+}) - K e^{-r_{DOM}T} \Phi(d_{-})] = \frac{V_{d/f}}{K}$$</p>
<p>The ccy1/ccy2 price is the price you need to pay in foreign currency for an option on $1$ unit notional of the domestic currency.</p>
<p>$$V_{f/d} = \frac{V_{\% d}}{S_0} = \frac{V_{d/f}}{S_0 K}$$</p>
<p>The four prices above are relative to the notionals of $K$ in the domestic currency and $1$ in the foreign currency. If the actual notionals are $N_d$ and $N_f$ in domestic and foreign currencies where $N_d = K \cdot N_f$, then we scale accordingly.</p>
<h3 id="implementing-the-bl-calculator-and-option-greeks">Implementing the Bl Calculator and Option Greeks.</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Author. Quasar C.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Date. 19-11-2023</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> norm
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> enum <span style="color:#f92672">import</span> Enum
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># An FX option is the right to exchange 1 unit notional of the </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># foreign currency for K units of the domestic currency at time T. </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CallPut</span>(Enum):
</span></span><span style="display:flex;"><span>    CALL_OPTION <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    PUT_OPTION <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">atTheMoneyForward</span>(S_t,K,t,T,r_DOM,r_FOR,sigma):
</span></span><span style="display:flex;"><span>    foreignDF <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>r_FOR<span style="color:#f92672">*</span>(T<span style="color:#f92672">-</span>t))
</span></span><span style="display:flex;"><span>    domesticDF <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>r_DOM<span style="color:#f92672">*</span>(T<span style="color:#f92672">-</span>t))
</span></span><span style="display:flex;"><span>    fwdPoints <span style="color:#f92672">=</span> foreignDF <span style="color:#f92672">/</span> domesticDF
</span></span><span style="display:flex;"><span>    F <span style="color:#f92672">=</span> fwdPoints <span style="color:#f92672">*</span> S_t
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> F
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dPlus</span>(S_t,K,t,T,r_DOM,r_FOR,sigma):
</span></span><span style="display:flex;"><span>    F <span style="color:#f92672">=</span> atTheMoneyForward(S_t,K,t,T,r_DOM,r_FOR,sigma)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (np<span style="color:#f92672">.</span>log(F<span style="color:#f92672">/</span>K) <span style="color:#f92672">+</span> (T<span style="color:#f92672">-</span>t)<span style="color:#f92672">*</span>(sigma<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">/</span>(sigma <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>sqrt(T <span style="color:#f92672">-</span> t))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dMinus</span>(S_t,K,t,T,r_DOM,r_FOR,sigma):
</span></span><span style="display:flex;"><span>    F <span style="color:#f92672">=</span> atTheMoneyForward(S_t,K,t,T,r_DOM,r_FOR,sigma)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (np<span style="color:#f92672">.</span>log(F<span style="color:#f92672">/</span>K) <span style="color:#f92672">-</span> (T<span style="color:#f92672">-</span>t)<span style="color:#f92672">*</span>(sigma<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">/</span>(sigma <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>sqrt(T <span style="color:#f92672">-</span> t))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">PV</span>(S_t,K,t,T,r_DOM,r_FOR,sigma, CCY1Notional,callPut):
</span></span><span style="display:flex;"><span>    F <span style="color:#f92672">=</span> atTheMoneyForward(S_t,K,t,T,r_DOM,r_FOR,sigma)
</span></span><span style="display:flex;"><span>    omega <span style="color:#f92672">=</span> callPut<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>    d_plus <span style="color:#f92672">=</span> dPlus(S_t,K,t,T,r_DOM,r_FOR,sigma)
</span></span><span style="display:flex;"><span>    d_minus <span style="color:#f92672">=</span> dMinus(S_t,K,t,T,r_DOM,r_FOR,sigma)
</span></span><span style="display:flex;"><span>    domesticDF <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>r_DOM<span style="color:#f92672">*</span>(T<span style="color:#f92672">-</span>t))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    undiscountedPrice <span style="color:#f92672">=</span> omega<span style="color:#f92672">*</span> (F <span style="color:#f92672">*</span> norm<span style="color:#f92672">.</span>cdf(omega <span style="color:#f92672">*</span> d_plus) <span style="color:#f92672">-</span> K <span style="color:#f92672">*</span> norm<span style="color:#f92672">.</span>cdf(omega <span style="color:#f92672">*</span> d_minus))
</span></span><span style="display:flex;"><span>    pv <span style="color:#f92672">=</span> domesticDF <span style="color:#f92672">*</span> undiscountedPrice <span style="color:#f92672">*</span> CCY1Notional
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pv
</span></span></code></pre></div><h4 id="computing-the-atm-forward-and-the-option-price">Computing the ATM-Forward and the option price</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>S_t<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0549</span> ; K<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0710350214586397</span> ; t<span style="color:#f92672">=</span><span style="color:#ae81ff">0.0</span> ;T<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span> ; 
</span></span><span style="display:flex;"><span>r_DOM<span style="color:#f92672">=</span><span style="color:#ae81ff">0.041039868</span> ; r_FOR<span style="color:#f92672">=</span> <span style="color:#ae81ff">0.025860353</span>; sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">0.08971</span> ; CCY1Notional<span style="color:#f92672">=</span><span style="color:#ae81ff">100.00</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>forward <span style="color:#f92672">=</span> atTheMoneyForward(S_t,K,t,T,r_DOM,r_FOR,sigma)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>call_price <span style="color:#f92672">=</span> PV(S_t,K,t,T,r_DOM,r_FOR,sigma, CCY1Notional,callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION)
</span></span><span style="display:flex;"><span>put_price <span style="color:#f92672">=</span> PV(S_t,K,t,T,r_DOM,r_FOR,sigma, CCY1Notional,callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>PUT_OPTION)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Notional = </span><span style="color:#e6db74">{</span>CCY1Notional<span style="color:#e6db74">}</span><span style="color:#e6db74"> EUR&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">At the money forward = </span><span style="color:#e6db74">{</span>forward<span style="color:#e6db74">}</span><span style="color:#e6db74"> USD&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Call Price = </span><span style="color:#e6db74">{</span>call_price<span style="color:#e6db74">}</span><span style="color:#e6db74"> USD pips&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Put Price = </span><span style="color:#e6db74">{</span>put_price<span style="color:#e6db74">}</span><span style="color:#e6db74"> USD pips&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Call price = </span><span style="color:#e6db74">{</span>call_price<span style="color:#f92672">/</span>S_t<span style="color:#e6db74">}</span><span style="color:#e6db74"> % EUR&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Put price = </span><span style="color:#e6db74">{</span>put_price<span style="color:#f92672">/</span>S_t<span style="color:#e6db74">}</span><span style="color:#e6db74"> % EUR&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Call price = </span><span style="color:#e6db74">{</span>call_price<span style="color:#f92672">/</span>K<span style="color:#e6db74">}</span><span style="color:#e6db74"> % USD&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Put price = </span><span style="color:#e6db74">{</span>put_price<span style="color:#f92672">/</span>K<span style="color:#e6db74">}</span><span style="color:#e6db74"> % USD&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Call price = </span><span style="color:#e6db74">{</span>call_price<span style="color:#f92672">/</span>(S_t <span style="color:#f92672">*</span> K)<span style="color:#e6db74">}</span><span style="color:#e6db74"> EUR pips&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Put price = </span><span style="color:#e6db74">{</span>put_price<span style="color:#f92672">/</span>(S_t <span style="color:#f92672">*</span> K)<span style="color:#e6db74">}</span><span style="color:#e6db74"> EUR pips&#34;</span>)
</span></span></code></pre></div><pre><code>Notional = 100.0 EUR

At the money forward = 1.0710350214586397 USD

Call Price = 3.6777787101031754 USD pips
Put Price = 3.6777787101031754 USD pips

Call price = 3.4863766329540007 % EUR
Put price = 3.4863766329540007 % EUR

Call price = 3.4338547633058893 % USD
Put price = 3.4338547633058893 % USD

Call price = 3.2551471829613132 EUR pips
Put price = 3.2551471829613132 EUR pips
</code></pre>
<h4 id="plotting-the-option-price-against-the-ccy1ccy2-spot">Plotting the option price against the CCY1CCY2 spot</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Plot of EUR Call/USD Put Option price&#39;</span>)
</span></span><span style="display:flex;"><span>S_t <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0.90</span>,<span style="color:#ae81ff">1.24</span>,<span style="color:#ae81ff">201</span>)
</span></span><span style="display:flex;"><span>CCY1Notional <span style="color:#f92672">=</span> <span style="color:#ae81ff">100.00</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>call_price_1y <span style="color:#f92672">=</span> PV(S_t,K,t,<span style="color:#ae81ff">1.0</span>,r_DOM,r_FOR,sigma, CCY1Notional,callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;EURUSD FX spot&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;Call option price (USD pips)&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(S_t,call_price_1y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="./../../../../exploring-option-greeks01.png" alt="png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Plot of EUR Put/USD Call Option price&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>put_price_1y <span style="color:#f92672">=</span> PV(S_t,K,t,<span style="color:#ae81ff">1.0</span>,r_DOM,r_FOR,sigma, CCY1Notional,callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>PUT_OPTION)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;EURUSD FX spot&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;Put option price (USD pips)&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(S_t,put_price_1y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="./../../../../exploring-option-greeks02.png" alt="png"></p>
<h2 id="outright-forward-rate">Outright forward rate.</h2>
<p>Consider a contract with payoff at time $T$, $V_T = R_T - K$. The value of this claim at time zero is:</p>
<p>$$
\begin{align*}
v_0 &amp;= e^{-r_{DOM}T}\mathbb{E}^{\mathbb{Q}^d}[R_T - K]\\
&amp;= e^{-r_{DOM}T}(R_0 \mathbb{E}^{\mathbb{Q}^d}[e^{(r_{DOM} - r_{FOR} - (\sigma^2/2))T + \sigma \sqrt{T} Z}] - K)\\
&amp;= e^{-r_{DOM}T}(R_0 e^{(r_{DOM} - r_{FOR})T} - K)\\
&amp;= R_0 e^{- r_{FOR}T} - K e^{-r_{DOM}T}
\end{align*}
$$</p>
<p>The forward price(strike) $K=F_{0,T}$ is set such that, the value of the contract at time zero is $0$. So,</p>
<p>$$
F_{0,T} = K =R_0 e^{(r_{DOM}-r_{FOR})T}
$$</p>
<h2 id="put-call-parity">Put call parity.</h2>
<p>We know that,</p>
<p>$$(S_T - K)^{+} - (K - S_T)^{+} = (S_T - K)$$</p>
<p>By the risk-neutral-pricing formula:</p>
<p>$$\mathbb{E}^{\mathbb{Q}^d}[e^{-r_{DOM}T}(S_T - K)^{+}|\mathcal{F_t}] - \mathbb{E}^{\mathbb{Q}^d}[e^{-r_{DOM}T}(K - S_T)^{+}|\mathcal{F_t}] = \mathbb{E}^{\mathbb{Q}^d}[e^{-r_{DOM}T}(S_T - K)|\mathcal{F_t}]$$</p>
<p>Thus,</p>
<p>$$V_{\text{call}}(t,T) - V_{\text{put}}(t,T) = e^{-r_{FOR}T}S_t - e^{-r_{DOM}T} K = F(t,T)$$</p>
<p>To derive the deltas, we use the following propositions, which are really easy to prove.</p>
<p><em><strong>Proposition.</strong></em></p>
<p>$$\frac{\partial d_{+}}{\partial S_0} = \frac{\partial d_{-}}{\partial S_0} = \frac{1}{\sigma S_0 \sqrt{T}}$$</p>
<p><em><strong>Proof</strong></em>.</p>
<p>We have:</p>
<p>$$
\begin{align*}
d_{\pm} &amp;= \frac{\log {S_0}}{\sigma \sqrt{T}} - \frac{\log {K} + (r \pm \sigma^2/2)T}{\sigma \sqrt{T}}\\
\frac{\partial d_{\pm}}{\partial S_0}&amp;= \frac{1}{\sigma\sqrt{T}}\frac{1}{S_0}
\end{align*}
$$</p>
<p><em><strong>Proposition.</strong></em></p>
<p>$$\frac{\partial \Phi(\omega d_{\pm})}{\partial S_0} = \frac{\omega}{\sigma S_0 \sqrt{T}}\phi(\omega d_{\pm})$$</p>
<p><em><strong>Proof.</strong></em></p>
<p>By chain rule, we have:</p>
<p>$$
\begin{align*}
\frac{\partial\Phi(\omega d_{\pm})}{\partial S_0} &amp;= \phi(\omega d_{\pm}) \frac{\partial (\omega d_{\pm})}{dS_0} \\
&amp;= \phi(\omega d_{\pm}) \frac{\omega}{\sigma S_0 \sqrt{T}}
\end{align*}
$$</p>
<p><em><strong>Proposition</strong></em>. The following general result holds:</p>
<p>$$\phi(\omega d_{+}) = \phi(\omega d_{-})\exp(\omega^2 [r_{FOR} - r_{DOM}]T)(K/S_0)^{\omega^2}$$</p>
<p><em><strong>Proof.</strong></em></p>
<p>We have:</p>
<p>$$
d_{+} + d_{-} = 2 \frac{\log (S_0/K) + (r_{FOR} - r_{DOM})T}{\sigma \sqrt{T}}
$$</p>
<p>$$
d_{+} - d_{-} = \sigma\sqrt{T}
$$</p>
<p>$$
\begin{align*}
\frac{\phi(\omega d_{+})}{\phi(\omega d_{-})} &amp;= \exp\left[-\omega^2\left(\frac{d_{+}^2-d_{-}^2}{2}\right)\right]\\
&amp;= \exp\left[-\omega^2(\log (S_0/K) + (r_{DOM} - r_{FOR})T)\right]\\
&amp;= \exp\left[\omega^2((r_{FOR} - r_{DOM})T)\right](K/S_0)^{\omega^2}
\end{align*}
$$</p>
<p>Also,</p>
<p>$$S_0 e^{-r_{FOR}\tau} \phi(d_{+}) = K e^{-r_{DOM}\tau} \phi(d_{-})$$</p>
<p><em><strong>Proposition.</strong></em> The following recurring identities hold:</p>
<p>(a) $\frac{\partial d_{+}}{\partial \sigma} = -\frac{d_{\mp}}{\sigma}$</p>
<p><em><strong>Proof.</strong></em></p>
<p>We have:</p>
<p>$$
\begin{align*}
\frac{\partial d_{\pm}}{\partial \sigma} &amp;= \frac{\partial}{\partial \sigma}\left(\frac{\log (F/K)}{\sigma \sqrt{\tau}} + \frac{1}{2}\sigma{\sqrt{\tau}}\right)\\
&amp;= \left(\frac{-\log (F/K)}{\sigma^2 \sqrt{\tau}} \pm \frac{1}{2}{\sqrt{\tau}}\right)\\
&amp;= -\left(\frac{\log (F/K)}{\sigma^2 \sqrt{\tau}} \mp \frac{\frac{\sigma^2}{2}\tau}{\sigma^2 \sqrt{\tau}}\right)\\
&amp;= -\frac{1}{\sigma}\left(\frac{\log (F/K) \mp \frac{\sigma^2}{2}\tau}{\sigma \sqrt{\tau}}\right)\\
&amp;= -\frac{d_{\mp}}{\sigma}
\end{align*}
$$</p>
<p>(b) $\frac{\partial d_{\pm}}{\partial r_{DOM}} = \frac{\sqrt{\tau}}{\sigma}$</p>
<p><em><strong>Proof.</strong></em></p>
<p>We have:</p>
<p>$$
\begin{align*}
\frac{\partial d_{\pm}}{\partial r_{DOM}} &amp;= \frac{\partial }{\partial r_{DOM}}\frac{\log (S_0/K) + (r_{DOM} - r_{FOR})\tau \pm (\sigma^2/2)\tau}{\sigma \sqrt{\tau}}\\
&amp;= \frac{\tau}{\sigma \sqrt{\tau}}\frac{\partial}{\partial {r_{DOM}}}(r_{DOM} - r_{FOR})\\
&amp;= \frac{\sqrt{\tau}}{\sigma}
\end{align*}
$$</p>
<p>(c) $\frac{\partial d_{\pm}}{\partial r_{FOR}}= - \frac{\sqrt{\tau}}{\sigma}$</p>
<p><em><strong>Proof.</strong></em></p>
<p>We have:</p>
<p>$$
\begin{align*}
\frac{\partial d_{\pm}}{\partial r_{FOR}} &amp;= \frac{\sqrt{\tau}}{\sigma}\frac{\partial}{\partial {r_{FOR}}} (r_{DOM} - r_{FOR})\\
&amp;= -\frac{\sqrt{\tau}}{\sigma}
\end{align*}
$$</p>
<h2 id="delta">Delta</h2>
<p>The delta of an option is the percentage of the foreign notional one must buy when you have a short position in an FX option. For instance, a delta of 0.35 indicates buying $35%$ of the foreign notional to delta hedge the short position. In FX markets, we distinguish between spot delta for a hedge in the spot market and forward delta for a hedge in the outright forward markets.</p>
<h3 id="pips-spot-delta">Pips Spot Delta</h3>
<p>The pips spot delta is simply the derivative of the option price with respect to the spot rate - both expressed in ccy2/ccy1 terms.</p>
<p>$$\Delta_{S;\text{pips}} = \frac{\partial V_{d;\text{pips}}}{\partial S_0}$$</p>
<p>Thus,</p>
<p>$$
\begin{align*}
\frac{\partial V_{\text{d;pips}}}{\partial S_0} &amp;= \omega\frac{\partial }{\partial S_0} \left[(S_0 e^{-r_{FOR}T} \Phi(\omega d_{+}) - K e^{-r_{DOM}T}\Phi(\omega d_{-})\right)]\\
&amp;= \omega \left[e^{-r_{FOR}T} \Phi(\omega d_{+}) + S_0 e^{-r_{FOR}T} \phi (\omega d_{+})\frac{\omega}{\sigma S_0 \sqrt{T}} - K e^{-r_{DOM}T}\phi (\omega d_{-})\frac{\omega}{\sigma S_0 \sqrt{T}}\right]\\
&amp;= \omega e^{-r_{FOR}T} \Phi(\omega d_{+}) + \frac{\omega^2}{\sigma S_0 \sqrt{T}}\left[S_0 e^{-r_{FOR}T} \phi(\omega d_{+}) - K e^{-r_{DOM}T}\phi(\omega d_{-})\right]\\
&amp;= \omega e^{-r_{FOR}T} \Phi(\omega d_{+}) + \frac{\omega^2}{\sigma S_0 \sqrt{T}}\left[S_0 e^{-r_{FOR}T} e^{(r_{FOR} - r_{DOM})T}\frac{K}{S_0}\phi(\omega d_{-}) - K e^{-r_{DOM}T}\phi(\omega d_{-})\right]\\
&amp;= \omega e^{-r_{FOR}T} \Phi(\omega d_{+}) + \frac{\omega^2}{\sigma S_0 \sqrt{T}}\left[K e^{-r_{DOM}T}\phi(\omega d_{-}) - K e^{-r_{DOM}T}\phi(\omega d_{-})\right]\\
&amp;= \omega e^{-r_{FOR}T} \Phi(\omega d_{+})
\end{align*}
$$</p>
<p>If we think of a delta hedge, it is just the number of units of foreign currency we need to hold in order to hedge an option with a notional of 1 unit of foreign currency and an equivalent notional of $K$ units of domestic currency. So, the spot delta is expressed as a percentage of the foreign currency.</p>
<h4 id="implementing-analytic-delta">Implementing Analytic Delta.</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">analyticDelta</span>(S_t,K,t,T,r_DOM,r_FOR,sigma,CCY1Notional, callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION):
</span></span><span style="display:flex;"><span>    omega <span style="color:#f92672">=</span> callPut<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>    d_plus <span style="color:#f92672">=</span> dPlus(S_t,K,t,T,r_DOM,r_FOR,sigma)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> omega <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>r_FOR <span style="color:#f92672">*</span> (T<span style="color:#f92672">-</span>t)) <span style="color:#f92672">*</span> norm<span style="color:#f92672">.</span>cdf(omega <span style="color:#f92672">*</span> d_plus) <span style="color:#f92672">*</span> CCY1Notional
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>S_t<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0549</span> ; CCY1Notional<span style="color:#f92672">=</span><span style="color:#ae81ff">100.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pips_spot_delta <span style="color:#f92672">=</span> analyticDelta(S_t,K,t,T,r_DOM,r_FOR,sigma,CCY1Notional, callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Call option Spot Delta = </span><span style="color:#e6db74">{</span>pips_spot_delta<span style="color:#e6db74">}</span><span style="color:#e6db74"> EUR&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Spot Delta in percentage = </span><span style="color:#e6db74">{</span>pips_spot_delta<span style="color:#f92672">/</span>CCY1Notional <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> percent&#34;</span>)
</span></span></code></pre></div><pre><code>Call option Spot Delta = 50.466746420569166 EUR
Spot Delta in percentage = 50.466746420569166 percent
</code></pre>
<h4 id="plotting-the-analytic-delta-of-call-options">Plotting the Analytic Delta of call options</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Plot of Analytic delta of the European call&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;EURUSD spot price&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$\frac{\partial V}{\partial S}$&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>S_t <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0.90</span>,<span style="color:#ae81ff">1.24</span>,<span style="color:#ae81ff">201</span>)
</span></span><span style="display:flex;"><span>CCY1Notional <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.00</span>
</span></span><span style="display:flex;"><span>delta <span style="color:#f92672">=</span> analyticDelta(S_t,K,t,<span style="color:#ae81ff">1.0</span>,r_DOM,r_FOR,sigma,CCY1Notional, callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(S_t,delta,label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;T=1Y&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upper left&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="./../../../../exploring-option-greeks03.png" alt="png"></p>
<h3 id="pips-forward-delta">Pips Forward Delta</h3>
<p>The interpretation of the foward delta is the number of units of FOR of forward contracts a trader needs to buy to delta hedge a short option position.</p>
<p>It is the ratio of the change in the FV of the option with respect to the change in value of the outright forward.</p>
<p>$$
\Delta_{\text{F;pips}}=e^{r_{DOM}T}\frac{\partial v_{\text{option}}}{\partial F_{0,T}}
$$</p>
<p>So, the derivative of the value of the forward contract with respect to the spot is:</p>
<p>$$\frac{\partial F_{0,T}}{\partial R_0} = e^{(r_{DOM} - r_{FOR})T}$$</p>
<p>Using the chain rule and the derivative of the inverse function, we obtain the forward delta:</p>
<p>$$
\begin{align*}
e^{r_{DOM}T}\frac{\partial v_{\text{option}}}{\partial F_{0,T}} &amp;= e^{r_{DOM}T}\frac{\partial v_{\text{option}}}{\partial R_0} \times \frac{\partial R_0}{\partial F_{0,T}}\\
&amp;=e^{r_{DOM}T} \cdot \omega e^{-r_{FOR}T}\Phi(\omega d_{+}) \times e^{(r_{FOR}- r_{DOM})T}\\
&amp;= \omega \Phi(\omega d_{+})
\end{align*}
$$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forwardDelta</span>(S_t,K,t,T,r_DOM,r_FOR,sigma,CCY1Notional, callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION):
</span></span><span style="display:flex;"><span>    omega <span style="color:#f92672">=</span> callPut<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>    d_plus <span style="color:#f92672">=</span> dPlus(S_t,K,t,T,r_DOM,r_FOR,sigma)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> omega  <span style="color:#f92672">*</span> norm<span style="color:#f92672">.</span>cdf(omega <span style="color:#f92672">*</span> d_plus) <span style="color:#f92672">*</span> CCY1Notional
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>S_t<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0549</span> ; CCY1Notional<span style="color:#f92672">=</span><span style="color:#ae81ff">100.00</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>forward_delta <span style="color:#f92672">=</span> forwardDelta(S_t,K,t,T,r_DOM,r_FOR,sigma,CCY1Notional, callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Forward Delta = </span><span style="color:#e6db74">{</span>forward_delta <span style="color:#e6db74">}</span><span style="color:#e6db74"> EUR of forward contracts&#34;</span>)
</span></span></code></pre></div><pre><code>Forward Delta = 51.78885572432219 EUR of forward contracts
</code></pre>
<h3 id="percentage-spot-premium-adjusted-delta">Percentage Spot (Premium-adjusted) Delta.</h3>
<p>The percentage spot delta is the ratio of the change in the PV of the option expressed in FOR currency terms - to the change in the spot - expressed in FOR currency terms.</p>
<p>$$
\begin{align*}
\Delta_{S;\%} &amp;= \frac{\partial V_{\% f}}{(\partial S_0)/S_0}\\
&amp;= S_0 \times \frac{\partial}{\partial S_0}\left(\frac{V_{\text{d;pips}}}{S_0}\right)\\
&amp;= S_0 \times \frac{S_0 \frac{\partial V_{\text{d;pips}}}{\partial S_0} - V_{\text{d;pips}} \frac{\partial (S_0)}{\partial S_0}}{S_0^2}\\
&amp;= \frac{(\partial V_{\text{d;pips}}/\partial S_0)S_0 -  V_{\text{d;pips}}}{S_0}\\
&amp;= \frac{\partial V_{\text{d;pips}}}{\partial S_0} - \frac{V_{\text{d;pips}}}{S_0}\\
&amp;= \Delta_{\text{S;pips}} - V_{\% f}
\end{align*}
$$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>premiumAdjustedDelta <span style="color:#f92672">=</span> pips_spot_delta <span style="color:#f92672">-</span> (call_price<span style="color:#f92672">/</span>S_t)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Premium Adjusted Delta = </span><span style="color:#e6db74">{</span>premiumAdjustedDelta<span style="color:#e6db74">}</span><span style="color:#e6db74"> percent&#34;</span>)
</span></span></code></pre></div><pre><code>Premium Adjusted Delta = 46.98036978761517 percent
</code></pre>
<h2 id="gamma">Gamma.</h2>
<p>$$
\begin{align*}
\frac{\partial^2 V}{\partial S_0^2} &amp;= \omega e^{-r_{FOR}T} \frac{\partial}{\partial S_0}\Phi(\omega d_{+}) \\
&amp;= \omega e^{-r_{FOR}T} \phi(\omega d_{+}) \frac{\omega}{\sigma S_0 \sqrt{T}}\\
&amp;= e^{-r_{FOR}T} \frac{\phi(\omega d_{+})}{\sigma S_0 \sqrt{T}}
\end{align*}
$$</p>
<p>The interpretation of the gamma is the change of the delta as the spot changes. A high gamma means that the delta hedge must be adapted very frequently and will cause transaction costs. Gamma is typically high when the spot is near a strike of a barrier, generally, whenever the payoff has a kink or dramatically a jump. Trading systems usually quote gamma as a <em>trader&rsquo;s gamma</em>, using a one percent relative change in the spot price.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">analyticGamma</span>(S_t,K,t,T,r_DOM,r_FOR,sigma,CCY1Notional, callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION):
</span></span><span style="display:flex;"><span>    omega <span style="color:#f92672">=</span> callPut<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>    d_plus <span style="color:#f92672">=</span> dPlus(S_t,K,t,T,r_DOM,r_FOR,sigma)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>r_FOR <span style="color:#f92672">*</span> (T<span style="color:#f92672">-</span>t)) <span style="color:#f92672">*</span> norm<span style="color:#f92672">.</span>cdf(omega <span style="color:#f92672">*</span> d_plus) <span style="color:#f92672">/</span> (sigma <span style="color:#f92672">*</span> S_t <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>sqrt(T<span style="color:#f92672">-</span>t)) <span style="color:#f92672">*</span> CCY1Notional
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>gamma <span style="color:#f92672">=</span> analyticGamma(S_t,K,t,T,r_DOM,r_FOR,sigma,CCY1Notional, callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Analytic Gamma = </span><span style="color:#e6db74">{</span>gamma<span style="color:#e6db74">}</span><span style="color:#e6db74"> EUR&#34;</span>)
</span></span></code></pre></div><pre><code>Analytic Gamma = 533.4269573839681 EUR
</code></pre>
<h3 id="theta">Theta.</h3>
<p>Let $\tau = T- t$, $\frac{\partial \tau}{\partial t} = -1$.</p>
<p>We first observe that:</p>
<p>$$
\begin{align*}
d_{-} &amp;= d_{+} - \sigma\sqrt{\tau}\\
\frac{\partial d_{-}}{\partial t} &amp;= \frac{\partial d_{+}}{\partial t} + \frac{\sigma}{2\sqrt{\tau}}
\end{align*}
$$</p>
<p>$$
\begin{align*}
\phi (d_{-}) &amp;= \exp\left[-\frac{1}{2}(d_{+} - \sigma \sqrt{\tau})^2\right]\\
&amp;= \exp\left[-\frac{1}{2}(d_{+}^2 -2 d_{+}\sigma\sqrt{\tau} + \sigma^2 \tau)\right]\\
&amp;= \exp\left(-\frac{1}{2}d_{+}^2\right) \exp(d_{+}\sigma\sqrt{\tau}) \exp(-\frac{1}{2} \sigma^2 \tau)\\
&amp;= \phi(d_{+}) \exp\left(\log \frac{S_0}{K} + (r_{DOM} - r_{FOR} + \frac{\sigma^2}{2})\tau\right) \exp(-\frac{1}{2} \sigma^2 \tau)\\
&amp;= \phi(d_{+}) \frac{S_0}{K} \exp((r_{DOM} - r_{FOR})\tau)\exp(\frac{\sigma^2 \tau}{2}) \exp(-\frac{1}{2} \sigma^2 \tau)\\
&amp;= \frac{S_0}{K} \cdot \phi(d_{+}) e^{(r_{DOM} - r_{FOR})\tau}
\end{align*}
$$</p>
<p>And since $\phi(\omega d_{\pm}) = \phi(d_{\pm})$, we can write:</p>
<p>$$\phi(\omega d_{-})= \frac{S_0}{K} \phi(\omega d_{+}) e^{(r_{DOM} - r_{FOR})\tau}$$</p>
<p>The value function of a vanilla European option is:</p>
<p>$$v_{\text{option}} = \omega [S_0 e^{-r_{FOR}\tau} \Phi(\omega d_{+}) - K e^{-r_{DOM}\tau} \Phi(\omega d_{-})]$$</p>
<p>Differentiating with respect to $t$, we get:</p>
<p>$$\frac{\partial v_{\text{option}}}{\partial t} = \omega[S_0 \frac{\partial }{\partial t}e^{-r_{FOR}\tau}\Phi(\omega d_{+}) - K \frac{\partial }{\partial t} e^{-r_{DOM}\tau}\Phi(\omega d_{-})]$$</p>
<p>The first term can be expressed as:</p>
<p>$$
\begin{align*}
\frac{\partial }{\partial t} e^{-r_{FOR}\tau} \Phi(\omega d_{+}) &amp;= r_{FOR}e^{-r_{FOR}\tau}\Phi(\omega d_{+}) + \omega e^{-r_{FOR}\tau} \phi(\omega d_{+}) \frac{\partial d_{+}}{\partial t}
\end{align*}
$$</p>
<p>The second term can be expressed as:</p>
<p>$$
\begin{align*}
\frac{\partial }{\partial t} e^{-r_{DOM}\tau}\Phi(\omega d_{-}) &amp;= r_{DOM}e^{-r_{DOM}\tau}\Phi(\omega d_{-}) + \omega  e^{-r_{DOM}\tau}\phi(\omega d_{-}) \frac{\partial d_{-}}{\partial t}\\
&amp;=r_{DOM}e^{-r_{DOM}\tau}\Phi(\omega d_{-}) + \omega \cdot \frac{S_0}{K}  e^{-r_{DOM}\tau}\phi(\omega d_{+}) e^{(r_{DOM} - r_{FOR})\tau}\left(\frac{\partial d_{+}}{\partial t} + \frac{\sigma}{2\sqrt{\tau}}\right)\\
&amp;=r_{DOM}e^{-r_{DOM}\tau}\Phi(\omega d_{-}) + \omega \cdot \frac{S_0}{K}  e^{-r_{FOR}\tau}\phi(\omega d_{+}) \left(\frac{\partial d_{+}}{\partial t} + \frac{\sigma}{2\sqrt{\tau}}\right)\\
\end{align*}
$$</p>
<p>Collecting the two terms we have:</p>
<p>$$
\begin{align*}
&amp;S_0 \frac{\partial }{\partial t} e^{-r_{FOR}\tau} \Phi(\omega d_{+}) - K \frac{\partial }{\partial t} e^{-r_{DOM}\tau}\Phi(\omega d_{-}) \\
=&amp; S_0 r_{FOR}e^{-r_{FOR}\tau}\Phi(\omega d_{+}) + \omega S_0 e^{-r_{FOR}\tau} \phi(\omega d_{+}) \frac{\partial d_{+}}{\partial t}\\
-&amp; K r_{DOM}e^{-r_{DOM}\tau}\Phi(\omega d_{-}) - \omega S_0  e^{-r_{FOR}\tau}\phi(\omega d_{+}) \left(\frac{\partial d_{+}}{\partial t} + \frac{\sigma}{2\sqrt{\tau}}\right)\\
=&amp; S_0 r_{FOR}e^{-r_{FOR}\tau}\Phi(\omega d_{+}) - K r_{DOM}e^{-r_{DOM}\tau}\Phi(\omega d_{-}) - \omega S_0  e^{-r_{FOR}\tau}\phi(\omega d_{+}) \frac{\sigma}{2\sqrt{\tau}}
\end{align*}
$$</p>
<p>Therefore,</p>
<p>$$
\begin{align*}
\frac{\partial v_{\text{option}}}{\partial t} &amp;= \omega [S_0 r_{FOR}e^{-r_{FOR}\tau}\Phi(\omega d_{+}) - K r_{DOM}e^{-r_{DOM}\tau}\Phi(\omega d_{-})] \\
&amp;- S_0  e^{-r_{FOR}\tau}\phi(\omega d_{+}) \frac{\sigma}{2\sqrt{\tau}}
\end{align*}
$$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">analyticTheta</span>(S_t,K,t,T,r_DOM,r_FOR,sigma,CCY1Notional, callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION):    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    omega <span style="color:#f92672">=</span> callPut<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>    FOR_df <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>r_FOR<span style="color:#f92672">*</span>(T<span style="color:#f92672">-</span>t)); DOM_df <span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>r_DOM<span style="color:#f92672">*</span>(T<span style="color:#f92672">-</span>t));
</span></span><span style="display:flex;"><span>    dplus <span style="color:#f92672">=</span> dPlus(S_t,K,t,T,r_DOM,r_FOR,sigma); dminus <span style="color:#f92672">=</span> dMinus(S_t,K,t,T,r_DOM,r_FOR,sigma);
</span></span><span style="display:flex;"><span>    Nd1 <span style="color:#f92672">=</span> norm<span style="color:#f92672">.</span>cdf(omega <span style="color:#f92672">*</span> dplus); Nd2 <span style="color:#f92672">=</span> norm<span style="color:#f92672">.</span>cdf(omega <span style="color:#f92672">*</span> dminus)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    theta <span style="color:#f92672">=</span> (omega <span style="color:#f92672">*</span> (S_t <span style="color:#f92672">*</span> r_FOR <span style="color:#f92672">*</span> FOR_df <span style="color:#f92672">*</span> Nd1 <span style="color:#f92672">-</span> K <span style="color:#f92672">*</span> r_DOM <span style="color:#f92672">*</span> DOM_df <span style="color:#f92672">*</span> Nd2) 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">-</span> S_t <span style="color:#f92672">*</span> FOR_df <span style="color:#f92672">*</span> Nd1 <span style="color:#f92672">*</span> (sigma <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>sqrt(T<span style="color:#f92672">-</span>t)))) <span style="color:#f92672">*</span> CCY1Notional
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> theta
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>S_t<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0549</span> ; CCY1Notional<span style="color:#f92672">=</span><span style="color:#ae81ff">100.00</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>theta <span style="color:#f92672">=</span> analyticTheta(S_t,K,t,T,r_DOM,r_FOR,sigma,CCY1Notional, callPut <span style="color:#f92672">=</span> CallPut<span style="color:#f92672">.</span>CALL_OPTION)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Analytic Theta = </span><span style="color:#e6db74">{</span>theta<span style="color:#e6db74">}</span><span style="color:#e6db74"> USD&#34;</span>)
</span></span></code></pre></div><pre><code>Analytic Theta = -3.04597416111385 USD
</code></pre>
<p>Theta reflects the change of the option value as the clock ticks. The <em>trader&rsquo;s theta</em> in a risk-management system refers to the change in the option value in one day, i.e. it can be approximated by $365 \frac{\partial v}{\partial t}$.</p>
<h3 id="vega">Vega.</h3>
<p>$$
\begin{align*}
\frac{\partial v}{\partial \sigma} &amp;= \omega[S_0 e^{-r_{FOR}\tau} \frac{\partial}{\partial \sigma}\Phi(\omega d_{+}) - K e^{-r_{DOM}\tau} \frac{\partial}{\partial \sigma}\Phi(\omega d_{-})]\\
&amp;= \omega[S_0 e^{-r_{FOR}\tau} \phi(\omega d_{+})\frac{\partial d_{+}}{\partial \sigma} - K e^{-r_{DOM}\tau} \phi(\omega d_{-}) \frac{\partial d_{-}}{\partial \sigma}]
\end{align*}
$$</p>
<p>Note that, $d_{-} = d_{+} - \sigma\sqrt{\tau}$, so $\frac{\partial d_{-}}{\partial \sigma} = \frac{\partial d_{+}}{\partial \sigma} - \sqrt{\tau}$.</p>
<p>Also, $\phi(\omega d_{-})=\frac{K}{S_0}e^{(r_{DOM} - r_{FOR})\tau}\phi(\omega d_{+})$.</p>
<p>Plugging these two facts in the expression for option vega, we get:</p>
<p>$$
\begin{align*}
\frac{\partial v}{\partial \sigma}  &amp;= \omega[S_0 e^{-r_{FOR}\tau} \phi(\omega d_{+})\frac{\partial d_{+}}{\partial \sigma} \\
&amp;- K e^{-r_{DOM}\tau} \frac{K}{S_0}e^{(r_{DOM} - r_{FOR})\tau}\phi(\omega d_{+}) \left(\frac{\partial d_{+}}{\partial \sigma} - \sqrt{\tau}\right)]\\
&amp;= S_0 e^{-r_{FOR}\tau} \phi(\omega d_{+}) \sqrt{\tau}
\end{align*}
$$</p>
<h3 id="vanna">Vanna.</h3>
<p>The vanna is <em>dvega/dspot</em>. It reflects the change in the vega as the spot moves.</p>
<p>$$
\begin{align*}
\frac{\partial^2 v}{\partial \sigma \partial S_0} &amp;= \frac{\partial}{\partial S_0} \left(\frac{\partial v}{\partial \sigma}\right)\\
&amp;= e^{-r_{FOR}\tau} \sqrt{\tau}\cdot \frac{\partial}{\partial S_0}(S_0\phi(\omega d_{+}))\\
&amp;= e^{-r_{FOR}\tau} \sqrt{\tau}(\phi(\omega d_{+}) + S_0 \frac{\partial}{\partial S_0}\phi(\omega d_{+}))\\
&amp;= e^{-r_{FOR}\tau} \sqrt{\tau}(\phi(\omega d_{+}) + \omega S_0 \frac{\partial}{\partial d_{+}}\phi(\omega d_{+})\cdot \frac{\partial d_{+}}{\partial S_0})\\
&amp;= e^{-r_{FOR}\tau} \sqrt{\tau}(\phi(\omega d_{+}) + \omega S_0\frac{1}{\sqrt{2\pi}} \cdot\frac{\partial}{\partial d_{+}}\exp(-d_{+}^2/2)\cdot \frac{1}{\sigma S_0 \sqrt{\tau}})\\
&amp;= e^{-r_{FOR}\tau} \sqrt{\tau}(\phi(\omega d_{+}) + \omega \frac{1}{\sqrt{2\pi}}e^{-d_{+}^2/2} (-d_{+})\cdot \frac{1}{\sigma \sqrt{\tau}})\\
&amp;= e^{-r_{FOR}\tau} \sqrt{\tau}\phi(\omega d_{+})(1 -  \frac{d_{+}}{\sigma \sqrt{\tau}})\\
&amp;= -e^{-r_{FOR}\tau} \phi(\omega d_{+})\frac{d_{-}}{\sigma}
\end{align*}
$$</p>
<h3 id="volga">Volga.</h3>
<p>The volga is <em>dvega/dvol</em>. It reflects the change in the vega as the vol moves.</p>
<p>We have:</p>
<p>$$
\begin{align*}
\frac{d^2 v}{d\sigma^2} &amp;= \frac{\partial}{\partial \sigma} \left(S_0 e^{-r_{FOR}\tau} \phi(\omega d_{+}) \sqrt{\tau}\right)\\
&amp;=S_0 e^{-r_{FOR}\tau} \sqrt{\tau} \cdot \frac{\partial}{\partial \sigma} \phi(\omega d_{+})\\
&amp;=S_0 e^{-r_{FOR}\tau} \sqrt{\tau} \cdot \frac{\partial}{\partial d_{+}}(\phi(\omega d_{+}))\cdot \frac{\partial}{\partial \sigma} d_{+}\\
&amp;=S_0 e^{-r_{FOR}\tau} \sqrt{\tau} \cdot (-d_{+})\phi(\omega d_{+})\cdot \frac{-d_{-}}{\sigma}\\
&amp;=S_0 e^{-r_{FOR}\tau} \sqrt{\tau} \phi(\omega d_{+})\frac{d_{+}d_{-}}{\sigma}
\end{align*}
$$</p>
<h2 id="rho">Rho.</h2>
<p>$$
\begin{align*}
\frac{\partial v}{\partial r_{DOM}} &amp;= \omega \frac{\partial}{\partial r_{DOM}}\left(S_0 e^{-r_{FOR} \tau} \Phi(\omega d_{+}) - K e^{-r_{DOM}\tau} \Phi(\omega d_{-})\right)\\
&amp;= \omega \left[S_0\right]
\end{align*}
$$</p>
<h2 id="at-the-money-definitions">At-The-Money Definitions</h2>
<p>The At-the-Money option, as the name suggests, is meant to correspond to, being midway between in-the-money and out-of-the-money. In practice, this is not as obvious:</p>
<p>ATM-Spot :</p>
<p>$$K = S_0$$</p>
<p>ATM Forward :</p>
<p>$$K = F_{0,T}$$</p>
<p>ATM value neutral straddle :</p>
<p>$$K \text{ such that call value = put value}$$</p>
<p>ATM delta neutral straddle :</p>
<p>$$K \text{ such that call delta = -put delta}$$</p>
<p>Since $V_{call} = V_{put}$, when $K = F_{0,T}$, <strong>ATM-value neutral</strong> is equivalent to <strong>ATMF</strong>.</p>
<h3 id="at-the-money-dnsdelta-neutral-strike">At-the-money DNS(Delta-neutral-strike)</h3>
<p>A more natural way to define an ATM strike is the strike $K_{ATM}$ for which it possible to buy a straddle (long call + long put with strike $K_{ATM}$) that  correponds to a pure long vega position with no net delta. This is called the <strong>Delta-Neutral-Straddle</strong> (DNS) and has the advantage that such a trade can be effected without and spot or forward hedge being needed.</p>
<p>The <strong>Delta-Neutral-Straddle</strong> is defined by $K_{ATM} = K_{DNS}$ where $K_{DNS}$ is chosen such that:</p>
<p>$$ \Delta_{Q}(\text{Call Option}) + \Delta_{Q}(\text{Put Option}) = 0$$</p>
<p>or equivalently,</p>
<p>$$ \Delta_{Q}(\omega=+1,K_{DNS},T,\sigma_{ATM}) + \Delta_{Q}(\omega=-1,K_{DNS},T,\sigma_{ATM}) = 0$$</p>
<p>where $Q$ is the quote convention for the option delta. Now, the deltas can be quoted as spot delta, forward delta, percentage spot delta or percentage forward delta.</p>
<p>Let&rsquo;s actually solve $K_{DNS}$ analytically in the simplest case of spot and foward delta.</p>
<p>We attempt to solve:</p>
<p>$$
(+1)\Phi\left(+\frac{\log(F/K) + (\sigma_{ATM}^2/2)T}{\sigma\sqrt{T}}\right) + (-1)\Phi\left(-\frac{\log(F/K) + (\sigma_{ATM}^2/2)T}{\sigma\sqrt{T}}\right)=0
$$</p>
<p>$$
\Phi\left(+\frac{\log(F/K) + (\sigma_{ATM}^2/2)T}{\sigma\sqrt{T}}\right) =\Phi\left(-\frac{\log(F/K) + (\sigma_{ATM}^2/2)T}{\sigma\sqrt{T}}\right)
$$</p>
<p>Since $\ln(\cdot)$ is monotonic, it follows that:</p>
<p>$$
\begin{align*}
2\log(F/K) + 2(\sigma_{ATM}^2/2)T &amp;= 0\\
\log(F/K) &amp;= - (\sigma_{ATM}^2/2)T \\
\log(K/F) &amp;= (\sigma_{ATM}^2/2)T\\
K_{DNS} &amp;= F_{0,T} e^{\frac{\sigma_{\text{ATM}}^2}{2}T}
\end{align*}
$$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>K_DNS <span style="color:#f92672">=</span> forward <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>exp(((sigma<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">*</span>T)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;ATM delta-neutral Strike = </span><span style="color:#e6db74">{</span>K_DNS<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><pre><code>ATM delta-neutral Strike = 1.0753534871192036
</code></pre>
<h2 id="market-strangles">Market Strangles</h2>
<p>Suppose that we neglect the effect of volatility skew and presume that volatility, while non-constant across various strikes, is basically symmetric. The concept of the market strangle is that we buy an out-of-the-money put and an out-of-the-money call with strikes placed a similar distance away from the at-the-money strike in moneyness terms. For clarity, let&rsquo;s suppose, we are talking about the 25-delta market strangle, though the market strangle for any delta is pretty similar.</p>
<p>The idea here is that, without needing to know the actual volatility smile, we can estimate the volatility that is needed to price a market strangle instrument consistently with the market, by taking the at-the-money volatility and adding a strangle premium $\sigma_{25-d-ms}$ to it. The premium thus added, in volatility terms, is called the market strangle.</p>
<p>The important point to make is that the strikes for calls and puts are both calculated subject to the Black-Scholes model with constant volatility of $\sigma_{ATM} + \sigma_{25-d-ms}$; these strikes are known as market strangle strikes $K_{25-d-c-ms}$ and $K_{25-d-p-ms}$. With that, we obtain strikes for calls and puts that have deltas of $+0.25$ and $-0.25$ respectively.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div>
</article>



</html>
